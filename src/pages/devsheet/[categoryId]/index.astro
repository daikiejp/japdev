---
import Layout from '../../../layouts/Layout.astro';
import { categories, getCategoryTopics } from '../../../data/devsheet/index';

export async function getStaticPaths() {
  const paths = [];
  
  for (const category of categories) {
    try {
      const topics = await getCategoryTopics(category.id);
      paths.push({
        params: { categoryId: category.id },
        props: { category, topics },
      });
    } catch (error) {
      console.error(`Error generating path for ${category.id}:`, error);
      paths.push({
        params: { categoryId: category.id },
        props: { category, topics: [] },
      });
    }
  }
  
  return paths;
}

const { categoryId } = Astro.params;
const { category, topics } = Astro.props;

if (!category) {
  return Astro.redirect('/devsheet');
}

// 最初のトピックが存在する場合はリダイレクト
if (topics && topics.length > 0) {
  return Astro.redirect(`/devsheet/${categoryId}/${topics[0].id}`);
}
---

<Layout title={`${category.name} - JapDev`}>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen">
    <div class="text-center">
      <div class="flex items-center justify-center gap-3 mb-4">
        <div class="w-16 h-16 flex items-center justify-center rounded-lg" style={`background: ${category.color}20;`}>
          <img src={category.logo} alt={category.name} class="w-10 h-10" />
        </div>
        <h1 class="text-4xl font-bold text-gray-900">{category.name}</h1>
      </div>
      <p class="text-gray-600 mb-6">{category.description}</p>
      <p class="text-gray-500 mb-6">このカテゴリには現在トピックがありません。</p>
      <a href="/devsheet" class="inline-block px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors">
        チートシート一覧に戻る
      </a>
    </div>
  </main>
</Layout>
