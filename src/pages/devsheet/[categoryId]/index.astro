---
import Layout from '../../../layouts/Layout.astro';
import { categories, getCategoryTopics } from '../../../utils/devsheet';

export async function getStaticPaths() {
  const paths = [];
  
  for (const category of categories) {
    try {
      const topics = await getCategoryTopics(category.id);
      paths.push({
        params: { categoryId: category.id },
        props: { category, topics },
      });
    } catch (error) {
      console.error(`Error generating path for ${category.id}:`, error);
      paths.push({
        params: { categoryId: category.id },
        props: { category, topics: [] },
      });
    }
  }
  
  return paths;
}

const { categoryId } = Astro.params;
const { category, topics } = Astro.props;

if (!category) {
  return Astro.redirect('/devsheet');
}
---

<Layout title={`${category.name} - JapDev`}>
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen">
    <!-- ヘッダー -->
    <div class="mb-8">
      <nav class="flex items-center gap-2 text-sm text-gray-600 mb-6">
        <a href="/devsheet" class="hover:text-emerald-600 transition-colors">チートシート</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="text-gray-900 font-medium">{category.name}</span>
      </nav>

      <div class="flex items-center gap-4 mb-4">
        <div class="w-16 h-16 flex items-center justify-center rounded-lg" style={`background: ${category.color}20;`}>
          <img src={category.logo} alt={category.name} class="w-12 h-12" />
        </div>
        <div>
          <h1 class="text-4xl font-bold text-gray-900">{category.name}</h1>
          <p class="text-gray-600 mt-1">{category.description}</p>
        </div>
      </div>
    </div>

    <!-- トピック一覧 -->
    {topics && topics.length > 0 ? (
      <div class="grid md:grid-cols-2 gap-6">
        {topics.map((topic) => (
          <a 
            href={`/devsheet/${categoryId}/${topic.id}`}
            class="block bg-white rounded-xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition-all hover:border-emerald-200 group"
          >
            <h2 class="text-xl font-bold text-gray-900 group-hover:text-emerald-600 transition-colors mb-2">
              {topic.name}
            </h2>
            {topic.description && (
              <p class="text-gray-600 text-sm mb-4">
                {topic.description}
              </p>
            )}
            <div class="flex items-center gap-2 text-emerald-600 font-medium text-sm">
              <span>詳細を見る</span>
              <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <p class="text-gray-500 mb-6">このカテゴリには現在トピックがありません。</p>
        <a href="/devsheet" class="inline-block px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors">
          チートシート一覧に戻る
        </a>
      </div>
    )}
  </main>
</Layout>
